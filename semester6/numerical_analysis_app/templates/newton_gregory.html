{% extends "base.html" %}

{% block content %}
<section class="method-section">
    <h2>Newton Gregory Forward Difference Interpolation</h2>

    <form method="POST">
        <div class="form-group">
            <label for="x_values">X values (comma separated, equally spaced):</label>
            <input type="text" id="x_values" name="x_values" required placeholder="e.g., 1,2,3,4,5"
                value="{% if show_result %}{{ ','.join(x_values|map('string')) }}{% endif %}">
        </div>

        <div class="form-group">
            <label for="y_values">Y values (comma separated):</label>
            <input type="text" id="y_values" name="y_values" required placeholder="e.g., 1,4,9,16,25"
                value="{% if show_result %}{{ ','.join(y_values|map('string')) }}{% endif %}">
        </div>

        <div class="form-group">
            <label for="x_target">Target X value for interpolation:</label>
            <input type="number" id="x_target" name="x_target" required step="any" placeholder="e.g., 2.5"
                value="{% if show_result %}{{ x_target }}{% endif %}">
        </div>

        <button type="submit">Calculate</button>
    </form>

    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}

    {% if show_result %}
    <div class="result-section">
        <h3>Result</h3>
        <p>Interpolated value at x = {{ x_target }}: <strong>{{ result }}</strong></p>
        <p>Step size h = {{ h }}, u = (x-x₀)/h = {{ u }}</p>

        <h4>Calculation Steps</h4>
        <ol>
            {% for step in steps %}
            <li>{{ step }}</li>
            {% endfor %}
            <li>Final result: {{ result }}</li>
        </ol>

        <h4>Forward Difference Table</h4>
        <div class="table-container">
            <table class="difference-table">
                <tr>
                    <th>x</th>
                    <th>y</th>
                    {% for i in range(1, diff_table[0]|length) %}
                    <th>Δ<sup>{{ i }}</sup>y</th>
                    {% endfor %}
                </tr>
                {% for i in range(x_values|length) %}
                <tr>
                    <td>{{ x_values[i] }}</td>
                    {% for j in range(diff_table[i]|length) %}
                    <td>{{ diff_table[i][j] }}</td>
                    {% endfor %}
                    {% for j in range(diff_table[i]|length, diff_table[0]|length) %}
                    <td>-</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>

        <h4>Newton Gregory Forward Formula</h4>
        <div class="formula">
            <p>P<sub>n</sub>(x) = y<sub>0</sub> + uΔy<sub>0</sub> + <sup>u(u-1)</sup>/<sub>2!</sub> Δ²y<sub>0</sub> +
                ... + <sup>u(u-1)...(u-n+1)</sup>/<sub>n!</sub> Δ<sup>n</sup>y<sub>0</sub></p>
            <p>where u = (x - x<sub>0</sub>)/h</p>
        </div>
    </div>
    {% endif %}
</section>

<style>
    .table-container {
        overflow-x: auto;
        margin: 1rem 0;
    }

    .difference-table {
        border-collapse: collapse;
        width: auto;
    }

    .difference-table th,
    .difference-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
        min-width: 80px;
    }

    .difference-table th {
        background-color: #f2f2f2;
    }

    .difference-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .formula {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 4px;
        margin: 1rem 0;
        overflow-x: auto;
    }

    input {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
        box-sizing: border-box;
    }
</style>
{% endblock %}